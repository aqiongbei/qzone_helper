(()=>{var t={867:()=>{console.log("comment.js loaded"),window.TASK||(window.TASK={}),window.TASK.comment={getComment(t,e){let o={url:"https://user.qzone.qq.com/proxy/domain/m.qzone.qq.com/cgi-bin/new/get_msgb",method:"GET",qs:{uin:base_info.uin,hostUin:base_info.uin,sort:0,s:.7434565759252794,format:"json",num:10,start:0,inCharset:"utf-8",outCharset:"utf-8",g_tk:base_info.g_tk,qzonetoken:base_info.token,g_tk:base_info.g_tk}};t&&t.qs&&(o.qs=Object.assign(o.qs,t.qs)),t&&t.data&&(o.data=Object.assign(o.data,t.data)),utils.request(o,(function(t){e&&e(t),utils.showTips(`获取留言列表成功! 当前进度: ${window.comment_list.length} / ${t.data.total}`)}))},deleteComment(){let t=[],e=[];window.comment_list.map((o=>{t.push(base_info.uin),e.push(o.id)})),utils.request({url:"https://h5.qzone.qq.com/proxy/domain/m.qzone.qq.com/cgi-bin/new/del_msgb",method:"POST",qs:{qzonetoken:base_info.token,g_tk:base_info.g_tk},data:{hostUin:base_info.uin,idList:e.join(),uinList:t.join(),format:"fs",iNotice:1,inCharset:"utf-8",outCharset:"utf-8",ref:"qzone",json:1,g_tk:base_info.g_tk,qzreferrer:"https://user.qzone.qq.com/proxy/domain/qzs.qq.com/qzone/msgboard/msgbcanvas.html#page=1"}},(function(e){e.includes("成功删除")?(utils.showTips(`删除留言${t.length}成功!`),window.comment_list=[]):utils.showTips(`删除留言${t.length}失败:\n${e}!`)})),utils.next((()=>{setTimeout((()=>{window.comment_list&&window.comment_list.length?this.deleteComment():this.delete()}),1e3)}))},delete(){this.getComment(null,(t=>{t.data&&t.data.total?(window.comment_list=t.data.commentList,utils.next((()=>{this.deleteComment()}))):(utils.showTips("删除留言完成!","succeed"),window.location.reload())}))},export(){let t=e=>{if(console.log("cb",e),e.data&&e.data.commentList&&(window.comment_list=window.comment_list.concat(e.data.commentList)),window.comment_list.length>=e.data.total)utils.download(JSON.stringify(window.comment_list,4," "),"comment_list.json"),window.comment_list=[],utils.showTips("导出留言完成!","succeed");else{let e={qs:{start:window.comment_list.length}};utils.next((()=>{this.getComment(e,t)}))}};this.getComment(null,t)}}},962:()=>{console.log("talk.js loaded"),window.TASK||(window.TASK={}),window.TASK.talk={getTalk(t,e){let o={url:"https://user.qzone.qq.com/proxy/domain/taotao.qq.com/cgi-bin/emotion_cgi_msglist_v6",method:"GET",qs:{uin:base_info.uin,inCharset:"utf-8",outCharset:"utf-8",hostUin:base_info.uin,notice:0,sort:0,pos:0,num:20,cgi_host:"https://user.qzone.qq.com/proxy/domain/taotao.qq.com/cgi-bin/emotion_cgi_msglist_v6",code_version:1,format:"json",need_private_comment:1,g_tk:base_info.g_tk,qzonetoken:base_info.token,g_tk:base_info.g_tk}};t&&t.qs&&(o.qs=Object.assign(o.qs,t.qs)),t&&t.data&&(o.data=Object.assign(o.data,t.data)),utils.request(o,(function(t){utils.showTips(`获取说说列表成功! 当前进度: ${window.talk_list.length} / ${t.total}条数据`),e&&e(t)}))},deleteTalk(){window.talk_list.splice(0,1).map((t=>{t.tid&&utils.request({url:"https://user.qzone.qq.com/proxy/domain/taotao.qzone.qq.com/cgi-bin/emotion_cgi_delete_v6",method:"POST",qs:{qzonetoken:base_info.token,g_tk:base_info.g_tk},data:{hostuin:base_info.uin,tid:t.tid,t1_source:1,code_version:1,format:"fs",qzreferrer:base_info.reffer}},(function(e){e.includes('"code":0')?utils.showTips(`删除说说${t.tid}成功!`):e.includes('"code":-3001')?(utils.showTips("删除说说失败!操作频繁需要验证.任务已暂停,请稍后重试!","fail"),window.stop_task=!0,window.talk_list=[]):e.includes("请先登录空间")?(utils.showTips("删除说说失败!操作异常被锁定.任务已暂停,请稍后重试!","fail"),window.stop_task=!0,window.talk_list=[]):utils.showTips(`删除说说${t.tid}失败!\n${e}`)}))})),utils.next((()=>{setTimeout((()=>{window.talk_list&&window.talk_list.length?this.deleteTalk():this.delete()}),500)}))},export(){let t=e=>{if(console.log("cb",e),e.total&&(window.talk_list=window.talk_list.concat(e.msglist)),window.talk_list.length>=e.total)utils.download(JSON.stringify(window.talk_list,4," "),"talk_list.json"),window.talk_list=[],utils.showTips("导出说说完成!","succeed");else{let e={qs:{pos:window.talk_list.length}};utils.next((()=>{this.getTalk(e,t)}))}};this.getTalk(null,t)},delete(){this.getTalk(null,(t=>{console.log("cb",t),t.total?(window.talk_list=t.msglist,utils.next((()=>{this.deleteTalk()}))):(utils.showTips("删除说说完成!","succeed"),window.location.reload())}))}}},323:()=>{console.log("utils.js loaded");let t=null;window.utils={showTips(e,o="info"){let n=document.querySelector(".ui-popup");n||(n=document.createElement("div"),n.role="dialog",n.tabindex=-1,n.className="ui-popup ui-popup-show ui-popup-focus",n.style.display="none",n.style.position="fixed",n.style.left="50%",n.style.top="40%",n.style.transform="translate(-50%, -50%)",n.style.bottom="auto",n.style.right="auto",n.style.margin="auto",n.style.padding="auto",n.style.outline=0,n.style["z-index"]=999990,n.style.border="0 none",n.style.background="transparent",document.body.appendChild(n));let i=`<div class="qz-tips-box qz-tips-box-m"><div class="tips-box-txt tips-${o}"><i class="icon-${o}-m"></i>${e}</div></div>`;n.innerHTML=i,"none"==n.style.display&&(n.style.display="block"),clearTimeout(t),t=setTimeout((()=>{t=null;let e=document.querySelector(".ui-popup");e&&(e.style.display="none")}),3e3)},serialize(t){let e="";for(let o in t)e+=""===e?o+"="+t[o]:"&"+o+"="+t[o];return e},getCookie(t){let e=document.cookie.split("; "),o={};return e.map((t=>{let e=t.split("=");o[e[0]]=e[1]})),t?o[t]:o},getGTK(){let t=this.getCookie(),e=t.p_skey||t.skey||t.rv2,o=5381;for(let t=0,n=e.length;t<n;++t)o+=(o<<5)+e.charAt(t).charCodeAt();return 2147483647&o},getBaseInfo(){let t={};t.g_tk=this.getGTK(),t.reffer=window.location.href;for(let e of document.scripts){let o=e.innerText,n="window.g_qzonetoken = (function(){ try{return";if(o&&o.includes(n)){let e=/"([^;]+)"/.exec(o)[1];t.token=e}if(n="g_iUin=",o&&o.includes(n)){let e=/(\d+),/.exec(o)[1];t.uin=e}}return console.log(t),t},request(t,e){let o=new XMLHttpRequest,n=t.qs;if(n){let e="?";for(let t in n)e+="?"===e?t+"="+n[t]:"&"+t+"="+n[t];t.url+=e}o.open(t.method,t.url,!0),"GET"==t.method?o.setRequestHeader("Content-Type","text/html; charset=utf-8"):o.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),o.withCredentials=!0,o.onreadystatechange=function(){if(4===o.readyState&&(/^2\d{2}/.test(o.status)||304===o.status)&&o.response){let t=o.response;try{t=JSON.parse(o.response)}catch(t){}e&&e(t)}},o.send(this.serialize(t.data))},download(t,e,o){let n=new Blob([t],{type:"applaction/json"}),i=URL.createObjectURL(n),s=document.createElement("a");s.style="display:none",s.href=i,s.download=e,document.body.appendChild(s),s.click(),setTimeout((()=>{URL.revokeObjectURL(i),s.href="",o&&o()}))},stringify(t,e="talk"){},next(t){window.stop_task?(this.showTips("任务已经终止!"),window.location.reload()):t()}}}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,o),s.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";o(867),o(962),o(323);console.log("content_scripts loaded");const t={export_talk:{key:"export_talk",name:"导出说说"},delete_talk:{key:"delete_talk",name:"删除说说"},export_comment:{key:"export_comment",name:"导出留言"},delete_comment:{key:"delete_comment",name:"删除留言"},export_blog:{key:"export_blog",name:"导出日志"},delete_blog:{key:"delete_blog",name:"删除日志"},export_photo:{key:"export_photo",name:"导出相册"},delete_photo:{key:"delete_photo",name:"删除相册"},delete_all:{key:"delete_all",name:"一键清空说说+留言+日志+相册"}};!function(){let{name:e,author:o,version:n,homepage_url:i}=chrome.runtime.getManifest(),s=document.createElement("div");s.setAttribute("id","qzone_helper-wrapper"),s.innerHTML=`\n    <div class="top"><h3>${e}</h3><span id="qzone_helper-closeBtn">关闭</span></div>\n    <hr/>\n    <button data-action="export_talk" title="将说说的请求数据导出为json格式的文本,包含评论">\n      导出说说\n    </button>\n    <button data-action="delete_talk" class="warn">删除说说</button>\n    <br />\n    <br />\n    <button data-action="export_comment" title="将留言的请求数据导出为json格式的文本,包含评论">\n      导出留言\n    </button>\n    <button data-action="delete_comment" class="warn">删除留言</button>\n    <br />\n    <br />\n    <button data-action="stop_all" class="long">终止任务</button>\n    <hr/>\n    <footer>version: ${n} author: ${o} <a href=${i}>Github</a></footer>\n    `,document.body.appendChild(s),s.addEventListener("click",(function(e){console.log("e",e),e.target.disabled=!0;let o=e.target.getAttribute("data-action");o&&function(e){if(function(){window.location.href.includes("user.qzone.qq.com")||(window.location.href="https://qzone.qq.com")}(),function(){window.comment_list=[],window.talk_list=[],window.blog_list=[],window.comment_total=0,window.comment_has_total=0,window.talk_total=0,window.blog_total=0,window.comment_page=0,window.base_info=utils.getBaseInfo(),window.stop_task=!1,window.tip_queue=[]}(),"stop_all"==e)return window.stop_task=!0,void utils.showTips("终止任务成功!","succeed");switch(utils.showTips(`开始处理 < ${t[e].name} > 任务`),e){case t.export_talk.key:TASK.talk.export();break;case t.delete_talk.key:TASK.talk.delete();break;case t.export_comment.key:TASK.comment.export();break;case t.delete_comment.key:TASK.comment.delete();break;default:utils.showTips(`暂不支持 < ${t[e].name} > 任务`)}}(o)})),document.getElementById("qzone_helper-closeBtn").addEventListener("click",(function(){document.body.removeChild(s)}))}()})()})();